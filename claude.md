# CLAUDE.md - Contexte Projet

> **Derni√®re mise √† jour :** 7 octobre 2025  
> **Version :** 0.1.0 (MVP en d√©veloppement)

---

## üéØ VUE D'ENSEMBLE

### Nom du projet
Booklin

### Pitch en une ligne
Marketplace SaaS qui met en relation des professionnels du domicile (coiffeurs, barbiers, masseurs, etc.) avec des clients particuliers, via un **mod√®le d'abonnement** (pas de commission sur prestations).

### Probl√®me r√©solu
- **Pour les pros :** Wecasa prend 25% de commission ‚Üí Notre solution : abonnement fixe 49‚Ç¨/mois, ils gardent 100% de leurs revenus
- **Pour les clients :** Difficile de trouver des pros de confiance √† proximit√© ‚Üí Notre solution : plateforme centralis√©e avec avis v√©rifi√©s

### Diff√©renciation cl√© vs Wecasa (concurrent principal)
1. **Mod√®le √©conomique** : Abonnement mensuel au lieu de commission 25%
2. **Choix du pro** : Client choisit son pro d√®s la 1√®re r√©servation
3. **Support humain** : Service client accessible par t√©l√©phone
4. **S√©lection qualit√©** : Vetting strict des professionnels

---

## üèóÔ∏è ARCHITECTURE TECHNIQUE

### Stack

**Frontend (apps/web)**
- Next.js 14 (App Router)
- React 18
- TypeScript
- Tailwind CSS
- Shadcn/ui (composants)
- Zustand (state management)

**Backend (apps/api)**
- Node.js
- Express
- TypeScript
- PostgreSQL (via Prisma ORM)
- Socket.io (messagerie temps r√©el - √† venir)
- Redis (cache - √† venir)

**Infrastructure**
- Monorepo : Turborepo + pnpm workspaces
- Auth : Clerk (ou NextAuth - √† d√©cider)
- Paiements : Stripe (abonnements)
- Images : Cloudinary
- Emails : SendGrid
- Maps : Google Maps API
- D√©ploiement : Vercel (frontend) + Railway (backend)

### Structure du monorepo

```
ton-projet/
‚îú‚îÄ‚îÄ apps/
‚îÇ   ‚îú‚îÄ‚îÄ web/                 # Frontend Next.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/            # Pages (App Router)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/     # Composants React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ lib/            # Utils & helpers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ public/         # Assets statiques
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ api/                 # Backend Express
‚îÇ       ‚îî‚îÄ‚îÄ src/
‚îÇ           ‚îú‚îÄ‚îÄ controllers/ # Logique m√©tier
‚îÇ           ‚îú‚îÄ‚îÄ routes/      # D√©finition routes
‚îÇ           ‚îú‚îÄ‚îÄ middleware/  # Auth, validation, etc.
‚îÇ           ‚îú‚îÄ‚îÄ services/    # Services externes
‚îÇ           ‚îú‚îÄ‚îÄ models/      # Prisma client
‚îÇ           ‚îî‚îÄ‚îÄ server.ts    # Entry point
‚îÇ
‚îú‚îÄ‚îÄ packages/
‚îÇ   ‚îú‚îÄ‚îÄ types/              # Types TypeScript partag√©s
‚îÇ   ‚îú‚îÄ‚îÄ ui/                 # Composants partag√©s (futur)
‚îÇ   ‚îî‚îÄ‚îÄ config/             # Configs ESLint, TS, etc.
‚îÇ
‚îú‚îÄ‚îÄ turbo.json              # Config Turborepo
‚îî‚îÄ‚îÄ package.json            # Root package.json
```

---

## üíæ MOD√àLE DE DONN√âES

### Entit√©s principales

**User**
- id, email, password (hashed), role (CLIENT/PRO)
- firstName, lastName, phone, avatar
- createdAt, updatedAt

**ProProfile** (extend User si role=PRO)
- businessName, bio, profession
- address, latitude, longitude, radius (km)
- photos[] (URLs)
- isPremium (boolean), subscriptionEnd (date)
- rating (float), reviewCount (int)

**Service**
- id, proId (FK)
- name, description, price, duration (minutes)

**Booking**
- id, clientId (FK), proId (FK), serviceId (FK)
- date, startTime, endTime
- status (PENDING/CONFIRMED/CANCELLED/COMPLETED)
- clientMessage (optional)

**Review**
- id, bookingId (FK unique), clientId (FK), proId (FK)
- rating (1-5), comment (optional)

**Message**
- id, senderId (FK), conversationId (FK)
- content, read (boolean)

**Conversation**
- id, clientId (FK), proId (FK)
- Unique constraint (clientId, proId)

---

## üí∞ MOD√àLE BUSINESS

### Revenus

**Freemium pour pros :**
- **FREE** : Gratuit, 10 demandes/mois max, position al√©atoire
- **PREMIUM** : 49‚Ç¨/mois, demandes illimit√©es, boost recherche, stats, etc.

**Pas de commission** sur les transactions client-pro (paiement direct hors plateforme).

### Timeline mon√©tisation

- **Mois 0-6** : Tout GRATUIT (construction marketplace)
- **Mois 6-9** : Introduction freemium progressif
- **Mois 9+** : Freemium actif avec objectif 10-20% conversion

### Objectifs financiers Ann√©e 1

- 200 pros actifs
- 20-40 pros Premium (10-20% conversion)
- 1 000‚Ç¨ MRR (Monthly Recurring Revenue)

---

## üé® CONVENTIONS DE CODE

### TypeScript

**Strict mode activ√©**
```json
{
  "strict": true,
  "noImplicitAny": true,
  "strictNullChecks": true
}
```

**Types partag√©s dans `packages/types`**
```typescript
// Importer depuis n'importe o√π
import { User, Booking, BookingStatus } from '@repo/types';
```

### Naming conventions

**Fichiers**
- Composants : `PascalCase.tsx` (ex: `ProCard.tsx`)
- Utils : `camelCase.ts` (ex: `formatDate.ts`)
- Routes API : `kebab-case.ts` (ex: `user-controller.ts`)

**Variables**
- `camelCase` pour variables et fonctions
- `PascalCase` pour composants et classes
- `UPPER_SNAKE_CASE` pour constantes

**Routes API**
```
GET    /api/pros          ‚Üí Liste pros
GET    /api/pros/:id      ‚Üí D√©tails pro
POST   /api/bookings      ‚Üí Cr√©er r√©servation
PATCH  /api/bookings/:id  ‚Üí Modifier r√©servation
```

### Composants React

**Structure recommand√©e**
```typescript
// components/pro/ProCard.tsx
import { ProProfile } from '@repo/types';

interface ProCardProps {
  pro: ProProfile;
  onBook?: () => void;
}

export function ProCard({ pro, onBook }: ProCardProps) {
  // Logic
  return (
    // JSX
  );
}
```

**Pas de default exports sauf pour pages Next.js**

### API Routes (Express)

**Structure controller**
```typescript
// controllers/booking.controller.ts
import { Request, Response } from 'express';
import { CreateBookingDTO } from '@repo/types';

export const createBooking = async (
  req: Request<{}, {}, CreateBookingDTO>,
  res: Response
) => {
  try {
    // Logic
    res.status(201).json({ success: true, data: booking });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
};
```

**Format r√©ponses API standardis√©**
```typescript
// Success
{ success: true, data: {...} }

// Error
{ success: false, error: "Message d'erreur" }
```

---

## üîê ENVIRONNEMENT & SECRETS

### Variables d'environnement

**apps/web/.env.local**
```env
NEXT_PUBLIC_API_URL=http://localhost:4000
NEXT_PUBLIC_GOOGLE_MAPS_KEY=...
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=...
```

**apps/api/.env**
```env
PORT=4000
NODE_ENV=development
DATABASE_URL=postgresql://user:pass@localhost:5432/dbname
JWT_SECRET=...
STRIPE_SECRET_KEY=...
SENDGRID_API_KEY=...
CLOUDINARY_CLOUD_NAME=...
```

**‚ö†Ô∏è CRITIQUE : Ne JAMAIS commit les .env**

Toujours cr√©er `.env.example` avec des placeholders :
```env
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
JWT_SECRET=your-secret-here
```

---

## üöÄ COMMANDES ESSENTIELLES

### Installation
```bash
pnpm install
```

### D√©veloppement
```bash
# Tout lancer (frontend + backend)
pnpm dev

# Frontend uniquement
pnpm dev --filter=web

# Backend uniquement
pnpm dev --filter=api
```

### Build
```bash
pnpm build
```

### Base de donn√©es (Prisma)
```bash
# G√©n√©rer client Prisma
pnpm --filter=api prisma generate

# Cr√©er migration
pnpm --filter=api prisma migrate dev --name nom_migration

# Ouvrir Prisma Studio
pnpm --filter=api prisma studio
```

### Lint & Format
```bash
pnpm lint
pnpm format
```

---

## üì¶ GESTION DES PACKAGES

### Ajouter une d√©pendance

**Dans le frontend**
```bash
pnpm --filter=web add package-name
```

**Dans le backend**
```bash
pnpm --filter=api add package-name
```

**Dans types partag√©s**
```bash
pnpm --filter=@repo/types add package-name
```

### Ajouter dev dependency √† la racine
```bash
pnpm add -D -w package-name
```

---

## üéØ ROADMAP MVP (Phase 1)

### Fonctionnalit√©s essentielles

**‚úÖ Fait**
- [x] Setup monorepo Turborepo
- [x] Frontend Next.js + Shadcn
- [x] Backend Express + TypeScript

**üöß En cours**
- [ ] Auth (Clerk ou NextAuth)
- [ ] Base de donn√©es PostgreSQL + Prisma
- [ ] Sch√©ma DB complet

**üìã √Ä faire (MVP)**
- [ ] Pages : Homepage, Recherche, Profil pro, Dashboard
- [ ] Profil pro (cr√©ation + affichage public)
- [ ] Syst√®me de r√©servation basique
- [ ] Messagerie in-app
- [ ] Syst√®me d'avis
- [ ] Calendrier disponibilit√©s

**üéØ Objectif :** MVP fonctionnel en 2-3 mois

---

## üß™ TESTS

### Strat√©gie de test (√Ä mettre en place)

**Backend**
- Jest pour tests unitaires
- Supertest pour tests API

**Frontend**
- React Testing Library
- Playwright pour E2E (plus tard)

**√Ä prioriser en MVP :**
- Tests critiques uniquement (auth, paiements)
- Tests complets apr√®s validation march√©

---

## üêõ DEBUGGING

### Frontend (Next.js)

**Console errors**
```bash
# V√©rifier logs terminal
pnpm dev --filter=web
```

**React DevTools**
- Installer extension Chrome
- Inspecter composants et state

### Backend (Express)

**Logs**
```typescript
// Ajouter des console.log strat√©giques
console.log('[DEBUG] User data:', userData);
```

**Postman / Thunder Client**
- Tester routes API directement
- Voir r√©ponses et erreurs

### Base de donn√©es

**Prisma Studio**
```bash
pnpm --filter=api prisma studio
```
Ouvre interface graphique pour voir/√©diter donn√©es

---

## üìö RESSOURCES & DOCUMENTATION

### Documentation officielle
- [Next.js Docs](https://nextjs.org/docs)
- [Prisma Docs](https://www.prisma.io/docs)
- [Shadcn/ui](https://ui.shadcn.com/)
- [Turborepo Docs](https://turbo.build/repo/docs)

### Patterns & Best Practices
- [Next.js Patterns](https://nextjs.org/docs/app/building-your-application)
- [React Patterns](https://www.patterns.dev/)
- [API Design Best Practices](https://swagger.io/resources/articles/best-practices-in-api-design/)

### Inspiration
- Wecasa : https://www.wecasa.fr/
- Treatwell : https://www.treatwell.fr/

---

## üö® PROBL√àMES CONNUS & SOLUTIONS

### "Module not found" apr√®s ajout package
```bash
# Solution : R√©installer
rm -rf node_modules
pnpm install
```

### Hot reload ne fonctionne pas
```bash
# Solution : Restart dev server
# Ctrl+C puis pnpm dev
```

### Prisma client out of sync
```bash
# Solution : R√©g√©n√©rer
pnpm --filter=api prisma generate
```

### CORS errors frontend ‚Üí backend
```typescript
// V√©rifier dans apps/api/src/server.ts
app.use(cors({
  origin: 'http://localhost:3000',
  credentials: true
}));
```

---

## üìã CHECKLIST AVANT COMMIT

Avant chaque commit, v√©rifie :

- [ ] Code compil√© sans erreurs TypeScript
- [ ] Pas de console.log oubli√©s (sauf debug intentionnel)
- [ ] Variables sensibles pas dans le code (utiliser .env)
- [ ] Lint passing : `pnpm lint`
- [ ] Build fonctionne : `pnpm build`
- [ ] Message de commit descriptif

**Format commit messages :**
```
feat: add user profile page
fix: resolve booking date bug
chore: update dependencies
docs: update README
```

---

## üéì POUR LES NOUVEAUX CONTRIBUTEURS

### Onboarding rapide

**1. Clone & Install (10 min)**
```bash
git clone [repo-url]
cd ton-projet
pnpm install
```

**2. Setup environnement (15 min)**
- Copier `.env.example` ‚Üí `.env` dans `apps/web` et `apps/api`
- Remplir les variables (demander les secrets √† l'√©quipe)

**3. Lancer en local (5 min)**
```bash
pnpm dev
```
- Frontend : http://localhost:3000
- Backend : http://localhost:4000

**4. Lire la documentation (30 min)**
- Ce fichier CLAUDE.md (contexte)
- README.md (instructions)
- Architecture dans `/docs` (si existe)

**5. Premier ticket (1h)**
- Prendre un ticket "good first issue"
- Cr√©er une branche : `git checkout -b feat/ton-ticket`
- Coder, tester, commit, push, PR

---

## üí° D√âCISIONS IMPORTANTES PRISES

### Pourquoi Turborepo ?
- Performance (cache intelligent)
- Scalabilit√© future (plusieurs apps/packages)
- Industrie standard pour monorepos modernes

### Pourquoi Next.js App Router ?
- SSR natif (meilleur SEO pour marketplace)
- Performance (Server Components)
- Future-proof (direction officielle Next.js)

### Pourquoi pas de commission ?
- Diff√©renciation forte vs Wecasa
- Meilleure marge pour les pros (attraction)
- Revenus r√©currents pr√©visibles (SaaS)

### Pourquoi Prisma ?
- Type-safety avec TypeScript
- Migrations faciles
- Excellent DX
- Prisma Studio pour debugging

### Pourquoi Express (pas tRPC/GraphQL) ?
- Simplicit√© pour MVP
- √âquipe habitu√©e REST
- √âvolutif si besoin plus tard

---

## üîÆ √âVOLUTIONS FUTURES (Post-MVP)

**Phase 2 (Mois 3-6)**
- Statistiques avanc√©es pros
- Templates messages automatiques
- Sync Google/Apple Calendar
- Notifications push (PWA)

**Phase 3 (Mois 6-12)**
- Application mobile native (React Native ou Flutter)
- Programme de fid√©lit√©
- Syst√®me de parrainage
- CRM int√©gr√© pour pros

**Phase 4 (Ann√©e 2+)**
- Expansion internationale
- API publique pour partenaires
- White-label pour grandes entreprises
- Intelligence artificielle (matching automatique)

---

## üìû CONTACT & SUPPORT

### Questions techniques
- Cr√©er une issue GitHub
- Tag avec label appropri√© (bug, question, enhancement)

### Discussions architecture
- GitHub Discussions
- R√©unions hebdomadaires (si √©quipe)

### Urgences
- [√Ä d√©finir : email, Slack, Discord ?]

---

## üéâ PHILOSOPHIE PROJET

### Valeurs

**1. User-first**
- Toujours tester avec de vrais utilisateurs
- Mesurer tout (analytics partout)
- It√©rer rapidement sur feedback

**2. Qualit√© > Quantit√©**
- Mieux vaut 5 features excellentes que 20 m√©diocres
- Code maintenable > code rapide
- Tests sur fonctionnalit√©s critiques

**3. Simplicit√©**
- KISS (Keep It Simple, Stupid)
- Pas d'over-engineering
- R√©soudre le probl√®me r√©el, pas un probl√®me imaginaire

**4. Transparence**
- Build in public
- Documentation √† jour
- D√©cisions expliqu√©es

### Mindset

> "Make it work, make it right, make it fast" ‚Äî Kent Beck

1. **Make it work** : MVP fonctionnel d'abord
2. **Make it right** : Refacto et tests ensuite
3. **Make it fast** : Optimisation quand n√©cessaire

---

## üìä M√âTRIQUES CL√âS √Ä SUIVRE

### Product Metrics
- Nombre inscriptions pros/semaine
- Nombre inscriptions clients/semaine
- Taux conversion demande ‚Üí r√©servation
- NPS (Net Promoter Score)

### Business Metrics
- MRR (Monthly Recurring Revenue)
- Taux conversion Free ‚Üí Premium
- Churn rate Premium
- LTV (Lifetime Value) pro

### Tech Metrics
- Uptime (objectif 99.9%)
- Temps r√©ponse API (objectif <200ms)
- Core Web Vitals (Lighthouse >90)

---

**üöÄ Bienvenue dans le projet ! Let's build something great. üí™**

---

*Ce fichier est un document vivant. Mets-le √† jour r√©guli√®rement au fur et √† mesure que le projet √©volue.*